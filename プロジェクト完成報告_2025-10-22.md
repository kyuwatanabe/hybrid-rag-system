# RAGシステム 完成報告

**プロジェクト名:** RAG (Retrieval-Augmented Generation) Chatbot
**完成日:** 2025年10月22日
**開発者:** Claude Code & GF001

---

## プロジェクト概要

PDFドキュメントを基にした質問応答システム。ユーザーの質問に対して、PDFの内容を検索し、Claude APIで回答を生成します。

### 特徴

1. **リアルタイム生成型**
   - FAQを事前生成せず、質問時に回答生成
   - 網羅性が高い
   - 新しいPDFに即対応

2. **ハルシネーション対策**
   - 参照情報のみを使用
   - 推測を禁止
   - 出典情報を必須表示

3. **モダンなUI**
   - チャット形式の美しいインターフェース
   - リアルタイム応答
   - レスポンシブデザイン

---

## システム構成

### アーキテクチャ

```
┌─────────────────────────────────────────────────┐
│                   ユーザー                        │
└────────────────┬────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────┐
│          Webインターフェース (Flask)               │
│  - チャットUI (HTML/CSS/JavaScript)              │
│  - API エンドポイント                             │
└────────────────┬────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────┐
│              RAGシステム (Python)                 │
│  1. ベクトル検索 (FAISS)                         │
│  2. 関連チャンク取得                              │
│  3. Claude API呼び出し                           │
│  4. 回答生成                                     │
└────────────────┬────────────────────────────────┘
                 │
        ┌────────┴────────┐
        ▼                 ▼
┌─────────────┐    ┌──────────────┐
│ ベクトルDB   │    │  Claude API  │
│  (FAISS)    │    │  (Haiku 3)   │
│  28チャンク  │    │              │
└─────────────┘    └──────────────┘
```

### 技術スタック

**バックエンド:**
- Python 3.11
- Flask 2.3.0
- sentence-transformers 5.1.1
- faiss-cpu 1.7.4
- anthropic 0.71.0

**フロントエンド:**
- HTML5
- CSS3 (Animations, Flexbox, Grid)
- Vanilla JavaScript (Fetch API)

**AI/ML:**
- Sentence Transformers (埋め込みモデル)
  - `paraphrase-multilingual-mpnet-base-v2`
- FAISS (ベクトル検索)
- Claude 3 Haiku (回答生成)

---

## 実装したフェーズ

### Phase 1: PDF前処理とベクトル化 ✅

**実装内容:**
- PDFからテキスト抽出（PyMuPDF）
- チャンク化（800文字、100文字オーバーラップ）
- セマンティック重複除去（類似度0.93以上）
- FAISSインデックス作成

**成果:**
- 13ページから28チャンク生成
- ベクトルDB構築完了

**ファイル:**
- `pdf_processor.py` (259行)
- `vector_store.py` (258行)

---

### Phase 2-3: 検索と回答生成 ✅

**実装内容:**
- ベクトル検索（Top 10 → Top 5に絞り込み）
- Claude API統合
- ハルシネーション対策プロンプト
- 出典情報の自動整形

**成果:**
- 正確な回答生成
- ハルシネーション防止機能（テスト済み）
- 出典情報表示

**ファイル:**
- `rag_system.py` (280行)

**テスト結果:**
- ✅ 正常な質問への回答
- ✅ ハルシネーションテスト（「東京の人口は？」→「資料に記載なし」）
- ✅ 出典情報の正確な表示

---

### Phase 4: Webインターフェース ✅

**実装内容:**
- Flaskアプリケーション
- チャットUI
- APIエンドポイント
- リアルタイム通信

**成果:**
- モダンで美しいUI
- スムーズな操作性
- ローカルサーバーで動作

**ファイル:**
- `app.py` (125行)
- `templates/index.html` (43行)
- `static/css/style.css` (296行)
- `static/js/chat.js` (201行)

---

## 使い方

### 1. セットアップ

```bash
# ディレクトリに移動
cd rag_system

# 仮想環境をアクティブ化
venv\Scripts\activate  # Windows
source venv/bin/activate  # Mac/Linux

# 依存ライブラリは既にインストール済み
```

### 2. 起動

```bash
# Webアプリケーションを起動
python app.py
```

**起動メッセージ:**
```
============================================================
RAG System Web Application
============================================================
Server running on: http://localhost:5001
Debug mode: True
============================================================
```

### 3. アクセス

ブラウザで以下のURLにアクセス:

```
http://localhost:5001
```

### 4. 使用

1. チャット画面が表示される
2. 質問を入力欄に入力
3. 「送信」ボタンをクリック
4. 回答が表示される
5. 出典情報（ファイル名、ページ番号）も表示される

---

## サンプル質問

```
ビザウェーバープログラムとは何ですか？
入国審査で必要な書類は何ですか？
滞在期間の延長はできますか？
```

---

## プロジェクト統計

### コード量

| ファイル | 行数 |
|---------|------|
| pdf_processor.py | 259行 |
| vector_store.py | 258行 |
| rag_system.py | 280行 |
| app.py | 125行 |
| index.html | 43行 |
| style.css | 296行 |
| chat.js | 201行 |
| **合計** | **1,462行** |

### データ

- PDFファイル: 1個（第2章.pdf）
- 抽出ページ数: 13ページ
- 生成チャンク数: 28個
- ベクトル次元: 768次元
- 使用モデル: `paraphrase-multilingual-mpnet-base-v2`

### 性能

- 初期化時間: 約5秒
- 検索時間: <1秒
- 回答生成時間: 3-5秒
- 合計応答時間: 4-6秒

---

## 既存FAQシステムとの比較

| 項目 | 既存FAQシステム | RAGシステム |
|-----|----------------|-------------|
| **アプローチ** | 事前生成型 | リアルタイム生成型 |
| **データベース** | SQLite | FAISS (ベクトルDB) |
| **回答速度** | 高速（<1秒） | 中速（4-6秒） |
| **網羅性** | 限定的 | 高い |
| **質問の柔軟性** | 低い | 高い |
| **品質保証** | 事前レビュー | ハルシネーション対策 |
| **コスト** | 初期高、運用低 | 初期低、運用高 |
| **適用場面** | よくある質問 | 特殊な質問 |

**結論:** 両システムは補完関係。ハイブリッドアプローチが最適。

---

## 今後の展開

### 短期（1週間）

- [ ] ユーザーテストの実施
- [ ] UI/UXの改善
- [ ] 会話履歴の表示機能
- [ ] 質問サンプルの表示

### 中期（1-2週間）

- [ ] 複数PDF対応
- [ ] キャッシュ機能（Redis）
- [ ] 管理画面の実装
- [ ] 統計情報の表示

### 長期（1ヶ月以上）

- [ ] 既存FAQシステムと統合（ハイブリッド）
- [ ] 評価機能の実装
- [ ] 本番環境デプロイ（Railway等）
- [ ] SSL対応
- [ ] ユーザー認証

---

## 作業履歴

詳細な作業履歴は以下のファイルを参照:

1. `作業履歴_RAGシステム準備_2025-10-21.md` - 準備作業
2. `作業履歴_Phase1完了_2025-10-22.md` - PDF処理とベクトル化
3. `作業履歴_Phase2-3完了_2025-10-22.md` - 検索と回答生成
4. `作業履歴_Phase4完了_2025-10-22.md` - Webインターフェース

---

## トラブルシューティング

### Q: サーバーが起動しない

**A:** 仮想環境がアクティブか確認してください。
```bash
venv\Scripts\activate
```

### Q: 「CLAUDE_API_KEYが見つからない」エラー

**A:** `.env`ファイルにAPIキーが設定されているか確認してください。

### Q: ポート5001が既に使用中

**A:** `.env`ファイルの`FLASK_PORT`を変更してください。
```
FLASK_PORT=5002
```

### Q: 回答が遅い

**A:** Claude APIの応答時間です。正常な動作です。キャッシュ機能の実装で改善予定。

---

## ライセンス

このプロジェクトは内部使用を目的としています。

---

## 謝辞

- **PyMuPDF** - PDFテキスト抽出
- **Sentence Transformers** - 埋め込みモデル
- **FAISS** - ベクトル検索
- **Anthropic Claude** - 回答生成
- **Flask** - Webフレームワーク

---

## 連絡先

**開発者:** GF001
**プロジェクトパス:** `C:\Users\GF001\Desktop\システム開発\手引き用チャットボット\rag_system`

---

**プロジェクト完成おめでとうございます！** 🎉
